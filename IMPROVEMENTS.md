# 🔧 코드 개선 사항 (2024-11-16)

## 📋 개선 내용

### 1️⃣ 뉴스 점수 비중 대폭 축소

#### Before (기존)
```python
# 뉴스 점수: 0~6점
# 최종 점수 = (기술적 분석 * 0.7) + (뉴스 * 0.5)
# → 기술 7점 vs 뉴스 3점 (30% 비중)
```

#### After (개선)
```python
# 뉴스 점수: 0~4점 (상한 축소)
# 최종 점수 = (기술적 분석 * 0.85) + (뉴스 * 0.25)
# → 기술 8.5점 vs 뉴스 1.0점 (10% 비중)
```

**변경 이유:**
- 단기 매매는 **차트가 우선**, 뉴스는 보조
- 뉴스 과대평가 방지
- 기술적 신호 중심 전략 강화

#### 추가 조정:
- 뉴스 시간 감쇠: 24시간 → **12시간 반감**
- 카테고리 가중치 축소 (예: M&A 1.8 → 1.5)
- 소스 가중치 축소 (예: Reuters 1.2 → 1.1)
- 전체 뉴스 점수에 0.7배 추가 감소

---

### 2️⃣ 종목 선별 공식 개선

#### Before (기존) - 거래대금 중심
```python
# 거래대금(ADV) 상위 200개만 선택
# → 대형주 위주, Apple, Microsoft, NVIDIA 등
F["score_u"] = (-F["rank_adv"] / m) * 2.0 + F["z_vol"] * 0.5 + F["z_ret"] * 0.5
```

#### After (개선) - 모멘텀 & 변동성 중심
```python
# 1) 거래대금은 최소 기준만 (하위 30% 제거)
# 2) 로그 스케일로 대형주 우대 완화
# 3) 변동성과 모멘텀 중심 점수

F["score_u"] = (
    F["z_log_adv"] * 0.15 +      # 거래대금 (로그) - 15%
    F["z_vol"] * 0.25 +          # 변동성 - 25%
    F["z_ret1d"] * 0.20 +        # 1일 수익률 - 20%
    F["z_ret5d"] * 0.25 +        # 5일 수익률 - 25%
    F["z_vol_ratio"] * 0.15      # 거래량 증가 - 15%
)
```

**변경 이유:**
- 거래대금만으로 선별 → 대형주만 선택됨
- **중소형주도 기회 포착** (변동성이 높으면 점수 UP)
- 모멘텀 강한 종목 우선 (단기 매매 특성)

#### 새로 추가된 지표:
- `ret5d`: 5일 수익률 (중기 추세 확인)
- `avg_vol_ratio`: 최근 거래량 증가 추세
- `log_adv`: 로그 거래대금 (대형주 과도 우대 방지)

---

### 3️⃣ 우량주 편향 완화

#### Before (기존)
```yaml
min_price: 5               # $5 이상만
max_price: (없음)          # 상한 없음
pool: sp500 / nasdaq100    # 우량주 풀만
```
→ 결과: Apple($180), Microsoft($380), NVIDIA($500) 등만 선택

#### After (개선)
```yaml
min_price: 3               # $3 이상 (더 낮춤)
max_price: 500             # $500 이하 (초고가주 제한)
```

**변경 이유:**
- $3~$10 구간 **중소형 성장주** 포함
- 변동성이 크고 단기 모멘텀 강한 종목 포착
- 다양성 확보

#### 가격대별 분포 (예상):
```
Under $20:    30~40개  ← 새롭게 포함!
$20-$50:      40~50개
$50-$100:     30~40개
Over $100:    30~40개
```

---

## 📊 실제 영향 비교

### 점수 계산 예시

**종목 A: Apple (대형 우량주)**
```
기술적 점수: 7.0
뉴스 점수: 2.5

[기존] = 7.0*0.7 + 2.5*0.5 = 4.9 + 1.25 = 6.15
[개선] = 7.0*0.85 + 2.5*0.25 = 5.95 + 0.625 = 6.575
```

**종목 B: 중소형주 (기술적 강함, 뉴스 없음)**
```
기술적 점수: 8.5
뉴스 점수: 0.0

[기존] = 8.5*0.7 + 0.0*0.5 = 5.95 + 0 = 5.95 ← 종목 A보다 낮음!
[개선] = 8.5*0.85 + 0.0*0.25 = 7.225 + 0 = 7.225 ← 종목 A보다 높음!
```

**→ 이제 차트가 좋으면 뉴스 없어도 높은 점수!**

---

## 🎯 개선 효과

### 1. 기술적 분석 중심
- ✅ 골든크로스, MACD 등 **차트 신호가 핵심**
- ✅ 뉴스는 보조 지표로만 활용
- ✅ 단기 매매 전략에 적합

### 2. 다양한 종목 발굴
- ✅ 대형주뿐 아니라 **중소형주도 포함**
- ✅ 변동성 높은 단기 기회 포착
- ✅ 가격대 다양화 ($3~$500)

### 3. 모멘텀 중심 선별
- ✅ 최근 5일 수익률 중요 (25% 가중치)
- ✅ 거래량 증가 추세 반영
- ✅ 변동성 높은 종목 우대

---

## 🧪 테스트 방법

### 개선 효과 확인:
```bash
# 1. 전체 봇 실행 (DRY_RUN 모드)
python -m src.main

# 2. 출력 확인:
# - 다양한 가격대의 종목이 나오는지
# - 뉴스 없어도 기술적으로 좋은 종목이 상위권인지
# - 대형주만 나오지 않는지
```

### 예상 출력:
```
=== US Pre-Open Watchlist (Technical Analysis) ===
- XYZ  | Tech 8.5 | News 0.0 | Total 7.2  <- 뉴스 없어도 높은 점수
- AAPL | Tech 7.0 | News 2.5 | Total 6.6
- SOUN | Tech 8.2 | News 0.5 | Total 7.1  <- 중소형주도 포함
```

---

## 📋 변경된 파일

1. `src/ranker.py` - 점수 계산 공식 변경
2. `src/news_scorer.py` - 뉴스 가중치 축소
3. `src/universe_builder.py` - 종목 선별 로직 개선
4. `config/universe.yaml` - 설정값 조정

---

## ⚠️ 주의사항

### 이전 버전과 비교 시:
- 추천 종목이 달라질 수 있음 (정상)
- 중소형주가 더 많이 나올 수 있음 (의도된 변경)
- 뉴스가 많아도 차트가 나쁘면 점수 낮음 (개선됨)

### 리스크 관리:
- 중소형주는 변동성이 큼 → **손절 더욱 중요**
- 거래량 확인 필수 (유동성)
- 분할 매수/매도 권장

---

## 💡 추가 개선 가능 사항 (향후)

1. **섹터 다양화**
   - 특정 섹터 편중 방지
   - 섹터별 균형 조정

2. **백테스팅**
   - 과거 데이터로 전략 검증
   - 승률 통계 산출

3. **리스크 조정**
   - 변동성 기반 포지션 사이징
   - 최대 손실 제한

---

**개선 완료!** 🎉

이제 더 균형 잡힌 단기 매매 추천 시스템입니다.
