<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stock Bot Dashboard</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
:root {
  --bg: #0a0e17;
  --surface: #111827;
  --surface2: #1a2235;
  --border: #2a3448;
  --text: #e2e8f0;
  --text2: #94a3b8;
  --accent: #38bdf8;
  --green: #34d399;
  --red: #f87171;
  --yellow: #fbbf24;
  --purple: #a78bfa;
  --orange: #fb923c;
  --font-mono: 'JetBrains Mono', monospace;
  --font-body: 'Noto Sans KR', sans-serif;
}
* { margin:0; padding:0; box-sizing:border-box; }
body {
  background: var(--bg);
  color: var(--text);
  font-family: var(--font-body);
  line-height: 1.6;
  min-height: 100vh;
}
.topbar {
  background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
  border-bottom: 1px solid var(--border);
  padding: 16px 24px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  z-index: 100;
  backdrop-filter: blur(12px);
}
.topbar h1 {
  font-family: var(--font-mono);
  font-size: 20px;
  font-weight: 700;
  background: linear-gradient(90deg, var(--accent), var(--purple));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
.topbar .meta {
  font-family: var(--font-mono);
  font-size: 12px;
  color: var(--text2);
}
.regime-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 4px 12px;
  border-radius: 20px;
  font-family: var(--font-mono);
  font-size: 12px;
  font-weight: 600;
}
.regime-bullish { background: rgba(52,211,153,0.15); color: var(--green); border: 1px solid rgba(52,211,153,0.3); }
.regime-bearish { background: rgba(248,113,113,0.15); color: var(--red); border: 1px solid rgba(248,113,113,0.3); }
.regime-sideways { background: rgba(251,191,36,0.15); color: var(--yellow); border: 1px solid rgba(251,191,36,0.3); }
.regime-unknown,.regime-conservative { background: rgba(148,163,184,0.15); color: var(--text2); border: 1px solid rgba(148,163,184,0.3); }

.container { max-width: 1400px; margin: 0 auto; padding: 20px; }

.tabs {
  display: flex;
  gap: 4px;
  margin-bottom: 20px;
  background: var(--surface);
  border-radius: 12px;
  padding: 4px;
  border: 1px solid var(--border);
  overflow-x: auto;
}
.tab {
  padding: 10px 20px;
  border-radius: 8px;
  cursor: pointer;
  font-family: var(--font-mono);
  font-size: 13px;
  color: var(--text2);
  transition: all 0.2s;
  white-space: nowrap;
  border: none;
  background: none;
}
.tab:hover { color: var(--text); background: var(--surface2); }
.tab.active { background: var(--accent); color: #0a0e17; font-weight: 600; }

.tab-content { display: none; }

.period-btns { display: flex; gap: 4px; }
.period-btn {
  padding: 5px 14px; border-radius: 6px; cursor: pointer;
  font-size: 12px; color: var(--text2); border: 1px solid var(--surface2);
  background: var(--surface); transition: all 0.2s; font-family: var(--font-mono);
}
.period-btn:hover { color: var(--text); border-color: var(--accent); }
.period-btn.active { background: var(--accent); color: #0a0e17; border-color: var(--accent); font-weight: 600; }
.tab-content.active { display: block; }

/* â”€â”€ ì¹´ë“œ â”€â”€ */
.grid { display: grid; gap: 16px; }
.grid-4 { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
.grid-3 { grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
.grid-2 { grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); }

.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 20px;
}
.card-header {
  font-family: var(--font-mono);
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 1.5px;
  color: var(--text2);
  margin-bottom: 8px;
}
.card-value {
  font-family: var(--font-mono);
  font-size: 28px;
  font-weight: 700;
}
.card-sub {
  font-family: var(--font-mono);
  font-size: 12px;
  color: var(--text2);
  margin-top: 4px;
}
.positive { color: var(--green); }
.negative { color: var(--red); }
.neutral { color: var(--yellow); }

/* â”€â”€ í…Œì´ë¸” â”€â”€ */
.table-wrap {
  overflow-x: auto;
  border-radius: 8px;
  border: 1px solid var(--border);
}
table {
  width: 100%;
  border-collapse: collapse;
  font-family: var(--font-mono);
  font-size: 13px;
}
th {
  background: var(--surface2);
  padding: 10px 14px;
  text-align: left;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--text2);
  white-space: nowrap;
  border-bottom: 1px solid var(--border);
}
td {
  padding: 10px 14px;
  border-bottom: 1px solid var(--border);
  white-space: nowrap;
}
tr:hover td { background: rgba(56,189,248,0.04); }
.status-open { color: var(--accent); }
.status-take_profit { color: var(--green); }
.status-stop_loss { color: var(--red); }
.status-expired { color: var(--yellow); }

.chart-box {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 16px;
}
.chart-box h3 {
  font-family: var(--font-mono);
  font-size: 13px;
  color: var(--text2);
  margin-bottom: 16px;
  text-transform: uppercase;
  letter-spacing: 1px;
}
canvas { max-height: 320px; }

.weight-bar {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
  font-family: var(--font-mono);
  font-size: 12px;
}
.weight-bar .label { width: 160px; color: var(--text2); text-align: right; }
.weight-bar .bar {
  flex: 1;
  height: 22px;
  background: var(--surface2);
  border-radius: 4px;
  position: relative;
  overflow: hidden;
}
.weight-bar .fill {
  height: 100%;
  border-radius: 4px;
  transition: width 0.5s ease;
}
.weight-bar .val {
  width: 50px;
  text-align: right;
  font-weight: 600;
}

.param-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 12px;
}
.param-item {
  background: var(--surface2);
  border-radius: 8px;
  padding: 14px;
  text-align: center;
}
.param-item .label {
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--text2);
  text-transform: uppercase;
  letter-spacing: 1px;
}
.param-item .value {
  font-family: var(--font-mono);
  font-size: 24px;
  font-weight: 700;
  color: var(--accent);
  margin-top: 4px;
}

.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: var(--text2);
  font-family: var(--font-mono);
}
.empty-state .icon { font-size: 48px; margin-bottom: 16px; }

.section-title {
  font-family: var(--font-mono);
  font-size: 14px;
  font-weight: 600;
  color: var(--text);
  margin: 24px 0 12px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--border);
}

/* â”€â”€ ìŠ¤í¬ë¡¤ë°” â”€â”€ */
::-webkit-scrollbar { width: 6px; height: 6px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: var(--text2); }

@media (max-width: 768px) {
  .grid-4 { grid-template-columns: repeat(2, 1fr); }
  .grid-2 { grid-template-columns: 1fr; }
  .topbar { flex-wrap: wrap; gap: 8px; }
  .tabs { flex-wrap: nowrap; }
}
</style>
</head>
<body>

<div class="topbar">
  <div>
    <h1>ğŸ“ˆ Stock Bot Dashboard</h1>
    <div class="meta" id="lastUpdate"></div>
  </div>
  <div style="display:flex;align-items:center;gap:12px;">
    <span class="regime-badge" id="regimeBadge"></span>
  </div>
</div>

<div class="container">
  <div class="tabs">
    <button class="tab active" onclick="showTab('market')">ğŸŒ ì‹œì¥ í˜„í™©</button>
    <button class="tab" onclick="showTab('positions')">ğŸ’¼ í¬ì§€ì…˜</button>
    <button class="tab" onclick="showTab('performance')">ğŸ“Š ì„±ê³¼</button>
    <button class="tab" onclick="showTab('backtest')">ğŸ”¬ ë°±í…ŒìŠ¤íŠ¸</button>
    <button class="tab" onclick="showTab('tuning')">ğŸ§  ìê¸°í•™ìŠµ</button>
  </div>

  <!-- â•â•â•â• TAB 0: ì‹œì¥ í˜„í™© â•â•â•â• -->
  <div id="tab-market" class="tab-content active">
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;flex-wrap:wrap;">
      <span style="color:var(--text2);font-size:14px;">ğŸ“… ê¸°ê°„:</span>
      <div class="period-btns" id="periodBtns">
        <button class="period-btn" data-range="1mo" onclick="switchPeriod('1mo')">1ê°œì›”</button>
        <button class="period-btn" data-range="3mo" onclick="switchPeriod('3mo')">3ê°œì›”</button>
        <button class="period-btn active" data-range="6mo" onclick="switchPeriod('6mo')">6ê°œì›”</button>
        <button class="period-btn" data-range="1y" onclick="switchPeriod('1y')">1ë…„</button>
      </div>
      <span id="marketStatus" style="color:var(--text2);font-size:12px;margin-left:auto;"></span>
    </div>
    <div class="grid grid-4" id="marketCards">
      <div class="empty-state" style="grid-column:1/-1"><div class="icon">â³</div>ì‹œì¥ ë°ì´í„° ë¡œë”© ì¤‘...</div>
    </div>
    <div class="grid grid-2" style="margin-top:16px;">
      <div class="chart-box"><h3 id="sp500Title">ğŸ“ˆ S&P 500</h3><canvas id="sp500Chart"></canvas></div>
      <div class="chart-box"><h3 id="nasdaqTitle">ğŸ“ˆ NASDAQ 100</h3><canvas id="nasdaqChart"></canvas></div>
    </div>
    <div class="grid grid-2" style="margin-top:16px;">
      <div class="chart-box"><h3 id="usdkrwTitle">ğŸ’± USD/KRW í™˜ìœ¨</h3><canvas id="usdkrwChart"></canvas></div>
      <div class="chart-box"><h3 id="goldTitle">ğŸ¥‡ Gold ì‹œì„¸</h3><canvas id="goldChart"></canvas></div>
    </div>
  </div>

  <!-- â•â•â•â• TAB 1: í¬ì§€ì…˜ â•â•â•â• -->
  <div id="tab-positions" class="tab-content">
    <div class="grid grid-4" id="statCards"></div>
    <div class="section-title">ğŸ“Œ ì˜¤í”ˆ í¬ì§€ì…˜</div>
    <div class="table-wrap" id="openPositionsTable"></div>
    <div class="section-title">ğŸ“œ ìµœê·¼ ì²­ì‚° ì´ë ¥</div>
    <div class="table-wrap" id="historyTable"></div>
  </div>

  <!-- â•â•â•â• TAB 2: ì„±ê³¼ â•â•â•â• -->
  <div id="tab-performance" class="tab-content">
    <div class="grid grid-2">
      <div class="chart-box"><h3>ğŸ“ˆ ëˆ„ì  ìˆ˜ìµë¥ </h3><canvas id="cumulativeChart"></canvas></div>
      <div class="chart-box"><h3>ğŸ“Š ì›”ë³„ ì„±ê³¼</h3><canvas id="monthlyChart"></canvas></div>
    </div>
    <div class="grid grid-2" style="margin-top:16px;">
      <div class="chart-box"><h3>ğŸ¯ ì²­ì‚° ìœ í˜• ë¹„ìœ¨</h3><canvas id="exitTypeChart"></canvas></div>
      <div class="chart-box"><h3>ğŸ“‹ ì›”ë³„ ìƒì„¸</h3><div id="monthlyDetailTable"></div></div>
    </div>
  </div>

  <!-- â•â•â•â• TAB 3: ë°±í…ŒìŠ¤íŠ¸ â•â•â•â• -->
  <div id="tab-backtest" class="tab-content">
    <div class="grid grid-4" id="btStatCards"></div>
    <div class="grid grid-2" style="margin-top:16px;">
      <div class="chart-box"><h3>ğŸ“¡ ì‹ í˜¸ë³„ ì„±ê³¼</h3><canvas id="signalChart"></canvas></div>
      <div class="chart-box"><h3>ğŸ¯ ì ìˆ˜ êµ¬ê°„ë³„ ì„±ê³¼</h3><canvas id="scoreBucketChart"></canvas></div>
    </div>
    <div class="chart-box" style="margin-top:16px;"><h3>ğŸ“… ë°±í…ŒìŠ¤íŠ¸ ì›”ë³„ ìˆ˜ìµ</h3><canvas id="btMonthlyChart"></canvas></div>
  </div>

  <!-- â•â•â•â• TAB 4: ìê¸°í•™ìŠµ â•â•â•â• -->
  <div id="tab-tuning" class="tab-content">
    <div class="section-title">âš™ï¸ í˜„ì¬ ì „ëµ íŒŒë¼ë¯¸í„°</div>
    <div class="param-grid" id="paramGrid"></div>
    <div class="section-title" style="margin-top:24px;">ğŸ“¡ ì‹ í˜¸ ê°€ì¤‘ì¹˜</div>
    <div id="weightBars"></div>
    <div class="section-title" style="margin-top:24px;">ğŸ“œ íŠœë‹ ì´ë ¥</div>
    <div class="table-wrap" id="tuningHistoryTable"></div>
  </div>
</div>

<footer style="max-width:1400px;margin:40px auto 0;padding:20px 20px 32px;border-top:1px solid var(--border);text-align:center;font-family:var(--font-mono);font-size:11px;color:var(--text2);line-height:1.8;">
  <div style="margin-bottom:6px;">âš ï¸ <strong style="color:var(--yellow);">ë©´ì±… ì¡°í•­</strong></div>
  ì´ ë´‡ì€ êµìœ¡ ë° ì •ë³´ ì œê³µ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤.<br>
  íˆ¬ì ìë¬¸ì´ ì•„ë‹™ë‹ˆë‹¤ Â· ëª¨ë“  íˆ¬ì ê²°ì •ì€ ë³¸ì¸ì˜ ì±…ì„ì…ë‹ˆë‹¤ Â· ê³¼ê±° ì„±ê³¼ê°€ ë¯¸ë˜ ìˆ˜ìµì„ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤ Â· ë°˜ë“œì‹œ ì†ì ˆë§¤ë¥¼ ì„¤ì •í•˜ì„¸ìš”
</footer>

<script>
const D = {"generated_at": "2026-02-14T01:44:35.660715+00:00", "positions": [{"ticker": "MNST", "status": "open", "entry_price": 80.56, "entry_date": "2026-02-12", "atr": 1.4814, "stop_loss": 77.5971, "take_profit": 86.4857, "tech_score": 7.6, "combined_score": 7.02, "exit_price": null, "exit_date": null, "pnl_pct": null, "close_reason": null, "price_history": [{"date": "2026-02-12", "close": 81.17}, {"date": "2026-02-13", "close": 81.48}]}, {"ticker": "WBD", "status": "open", "entry_price": 28.01, "entry_date": "2026-02-12", "atr": 0.4779, "stop_loss": 27.0543, "take_profit": 29.9214, "tech_score": 6.6, "combined_score": 6.62, "exit_price": null, "exit_date": null, "pnl_pct": null, "close_reason": null, "price_history": [{"date": "2026-02-12", "close": 28.11}, {"date": "2026-02-13", "close": 27.99}]}, {"ticker": "ABNB", "status": "open", "entry_price": 119.5, "entry_date": "2026-02-12", "atr": 3.8289, "stop_loss": 111.8421, "take_profit": 134.8157, "tech_score": 5.8, "combined_score": 5.5, "exit_price": null, "exit_date": null, "pnl_pct": null, "close_reason": null, "price_history": [{"date": "2026-02-12", "close": 115.96}, {"date": "2026-02-13", "close": 121.35}]}, {"ticker": "TSLA", "status": "open", "entry_price": 427.5676, "entry_date": "2026-02-12", "atr": 15.6386, "stop_loss": 396.2905, "take_profit": 490.1219, "tech_score": 4.6, "combined_score": 4.41, "exit_price": null, "exit_date": null, "pnl_pct": null, "close_reason": null, "price_history": [{"date": "2026-02-12", "close": 417.07}, {"date": "2026-02-13", "close": 417.44}]}, {"ticker": "ORLY", "status": "open", "entry_price": 93.8175, "entry_date": "2026-02-12", "atr": 2.3943, "stop_loss": 89.0289, "take_profit": 103.3946, "tech_score": 4.8, "combined_score": 4.08, "exit_price": null, "exit_date": null, "pnl_pct": null, "close_reason": null, "price_history": [{"date": "2026-02-12", "close": 95.21}, {"date": "2026-02-13", "close": 96.66}]}, {"ticker": "ISRG", "status": "open", "entry_price": 496.88, "entry_date": "2026-02-12", "atr": 13.3021, "stop_loss": 470.2757, "take_profit": 550.0885, "tech_score": 4.6, "combined_score": 3.91, "exit_price": null, "exit_date": null, "pnl_pct": null, "close_reason": null, "price_history": [{"date": "2026-02-12", "close": 478.6}, {"date": "2026-02-13", "close": 485.84}]}, {"ticker": "TMUS", "status": "open", "entry_price": 209.6228, "entry_date": "2026-02-12", "atr": 5.93, "stop_loss": 197.7628, "take_profit": 233.3428, "tech_score": 4.27, "combined_score": 3.63, "exit_price": null, "exit_date": null, "pnl_pct": null, "close_reason": null, "price_history": [{"date": "2026-02-12", "close": 214.68}, {"date": "2026-02-13", "close": 219.5}]}, {"ticker": "ADBE", "status": "open", "entry_price": 263.3, "entry_date": "2026-02-13", "atr": 10.695, "stop_loss": 241.91, "take_profit": 306.08, "tech_score": 5.0, "combined_score": 3.86, "exit_price": null, "exit_date": null, "pnl_pct": null, "close_reason": null, "price_history": []}], "stats": {"total_trades": 0, "wins": 0, "losses": 0, "expired": 0, "total_pnl_pct": 0.0, "win_rate": 0.0, "avg_pnl_pct": 0.0, "best_trade": null, "worst_trade": null, "last_updated": null}, "history": [], "daily_cumulative_pnl": {}, "monthly_performance": {}, "exit_types": {"take_profit": 0, "stop_loss": 0, "expired": 0}, "market_indices": {"sp500": {"name": "S&P 500", "current": 6836.17, "day_change": 0.05, "period_change": 5.68, "dates": ["2025-08-14", "2025-08-15", "2025-08-18", "2025-08-19", "2025-08-20", "2025-08-21", "2025-08-22", "2025-08-25", "2025-08-26", "2025-08-27", "2025-08-28", "2025-08-29", "2025-09-02", "2025-09-03", "2025-09-04", "2025-09-05", "2025-09-08", "2025-09-09", "2025-09-10", "2025-09-11", "2025-09-12", "2025-09-15", "2025-09-16", "2025-09-17", "2025-09-18", "2025-09-19", "2025-09-22", "2025-09-23", "2025-09-24", "2025-09-25", "2025-09-26", "2025-09-29", "2025-09-30", "2025-10-01", "2025-10-02", "2025-10-03", "2025-10-06", "2025-10-07", "2025-10-08", "2025-10-09", "2025-10-10", "2025-10-13", "2025-10-14", "2025-10-15", "2025-10-16", "2025-10-17", "2025-10-20", "2025-10-21", "2025-10-22", "2025-10-23", "2025-10-24", "2025-10-27", "2025-10-28", "2025-10-29", "2025-10-30", "2025-10-31", "2025-11-03", "2025-11-04", "2025-11-05", "2025-11-06", "2025-11-07", "2025-11-10", "2025-11-11", "2025-11-12", "2025-11-13", "2025-11-14", "2025-11-17", "2025-11-18", "2025-11-19", "2025-11-20", "2025-11-21", "2025-11-24", "2025-11-25", "2025-11-26", "2025-11-28", "2025-12-01", "2025-12-02", "2025-12-03", "2025-12-04", "2025-12-05", "2025-12-08", "2025-12-09", "2025-12-10", "2025-12-11", "2025-12-12", "2025-12-15", "2025-12-16", "2025-12-17", "2025-12-18", "2025-12-19", "2025-12-22", "2025-12-23", "2025-12-24", "2025-12-26", "2025-12-29", "2025-12-30", "2025-12-31", "2026-01-02", "2026-01-05", "2026-01-06", "2026-01-07", "2026-01-08", "2026-01-09", "2026-01-12", "2026-01-13", "2026-01-14", "2026-01-15", "2026-01-16", "2026-01-20", "2026-01-21", "2026-01-22", "2026-01-23", "2026-01-26", "2026-01-27", "2026-01-28", "2026-01-29", "2026-01-30", "2026-02-02", "2026-02-03", "2026-02-04", "2026-02-05", "2026-02-06", "2026-02-09", "2026-02-10", "2026-02-11", "2026-02-12", "2026-02-13"], "values": [6468.54, 6449.8, 6449.15, 6411.37, 6395.78, 6370.17, 6466.91, 6439.32, 6465.94, 6481.4, 6501.86, 6460.26, 6415.54, 6448.26, 6502.08, 6481.5, 6495.15, 6512.61, 6532.04, 6587.47, 6584.29, 6615.28, 6606.76, 6600.35, 6631.96, 6664.36, 6693.75, 6656.92, 6637.97, 6604.72, 6643.7, 6661.21, 6688.46, 6711.2, 6715.35, 6715.79, 6740.28, 6714.59, 6753.72, 6735.11, 6552.51, 6654.72, 6644.31, 6671.06, 6629.07, 6664.01, 6735.13, 6735.35, 6699.4, 6738.44, 6791.69, 6875.16, 6890.89, 6890.59, 6822.34, 6840.2, 6851.97, 6771.55, 6796.29, 6720.32, 6728.8, 6832.43, 6846.61, 6850.92, 6737.49, 6734.11, 6672.41, 6617.32, 6642.16, 6538.76, 6602.99, 6705.12, 6765.88, 6812.61, 6849.09, 6812.63, 6829.37, 6849.72, 6857.12, 6870.4, 6846.51, 6840.51, 6886.68, 6901.0, 6827.41, 6816.51, 6800.26, 6721.43, 6774.76, 6834.5, 6878.49, 6909.79, 6932.05, 6929.94, 6905.74, 6896.24, 6845.5, 6858.47, 6902.05, 6944.82, 6920.93, 6921.46, 6966.28, 6977.27, 6963.74, 6926.6, 6944.47, 6940.01, 6796.86, 6875.62, 6913.35, 6915.61, 6950.23, 6978.6, 6978.03, 6969.01, 6939.03, 6976.44, 6917.81, 6882.72, 6798.4, 6932.3, 6964.82, 6941.81, 6941.47, 6832.76, 6836.17]}, "nasdaq": {"name": "NASDAQ 100", "current": 24732.73, "day_change": 0.18, "period_change": 3.78, "dates": ["2025-08-14", "2025-08-15", "2025-08-18", "2025-08-19", "2025-08-20", "2025-08-21", "2025-08-22", "2025-08-25", "2025-08-26", "2025-08-27", "2025-08-28", "2025-08-29", "2025-09-02", "2025-09-03", "2025-09-04", "2025-09-05", "2025-09-08", "2025-09-09", "2025-09-10", "2025-09-11", "2025-09-12", "2025-09-15", "2025-09-16", "2025-09-17", "2025-09-18", "2025-09-19", "2025-09-22", "2025-09-23", "2025-09-24", "2025-09-25", "2025-09-26", "2025-09-29", "2025-09-30", "2025-10-01", "2025-10-02", "2025-10-03", "2025-10-06", "2025-10-07", "2025-10-08", "2025-10-09", "2025-10-10", "2025-10-13", "2025-10-14", "2025-10-15", "2025-10-16", "2025-10-17", "2025-10-20", "2025-10-21", "2025-10-22", "2025-10-23", "2025-10-24", "2025-10-27", "2025-10-28", "2025-10-29", "2025-10-30", "2025-10-31", "2025-11-03", "2025-11-04", "2025-11-05", "2025-11-06", "2025-11-07", "2025-11-10", "2025-11-11", "2025-11-12", "2025-11-13", "2025-11-14", "2025-11-17", "2025-11-18", "2025-11-19", "2025-11-20", "2025-11-21", "2025-11-24", "2025-11-25", "2025-11-26", "2025-11-28", "2025-12-01", "2025-12-02", "2025-12-03", "2025-12-04", "2025-12-05", "2025-12-08", "2025-12-09", "2025-12-10", "2025-12-11", "2025-12-12", "2025-12-15", "2025-12-16", "2025-12-17", "2025-12-18", "2025-12-19", "2025-12-22", "2025-12-23", "2025-12-24", "2025-12-26", "2025-12-29", "2025-12-30", "2025-12-31", "2026-01-02", "2026-01-05", "2026-01-06", "2026-01-07", "2026-01-08", "2026-01-09", "2026-01-12", "2026-01-13", "2026-01-14", "2026-01-15", "2026-01-16", "2026-01-20", "2026-01-21", "2026-01-22", "2026-01-23", "2026-01-26", "2026-01-27", "2026-01-28", "2026-01-29", "2026-01-30", "2026-02-02", "2026-02-03", "2026-02-04", "2026-02-05", "2026-02-06", "2026-02-09", "2026-02-10", "2026-02-11", "2026-02-12", "2026-02-13"], "values": [23832.44, 23712.07, 23713.76, 23384.77, 23249.57, 23142.58, 23498.12, 23425.61, 23525.29, 23565.85, 23703.45, 23415.42, 23231.11, 23414.84, 23633.01, 23652.44, 23762.3, 23839.8, 23849.27, 23992.56, 24092.19, 24293.78, 24274.25, 24223.69, 24454.89, 24626.25, 24761.07, 24580.17, 24503.57, 24397.31, 24503.85, 24611.35, 24679.99, 24800.86, 24892.76, 24785.52, 24978.56, 24840.23, 25136.62, 25098.18, 24221.74, 24750.25, 24579.32, 24745.36, 24657.24, 24817.95, 25141.02, 25127.13, 24879.01, 25097.41, 25358.16, 25821.55, 26012.15, 26119.85, 25734.81, 25858.13, 25972.94, 25435.7, 25620.03, 25130.04, 25059.81, 25611.74, 25533.49, 25517.33, 24993.46, 25008.24, 24799.92, 24503.1, 24640.52, 24054.38, 24239.57, 24873.85, 25018.36, 25236.94, 25434.89, 25342.85, 25555.86, 25606.54, 25581.7, 25692.05, 25627.95, 25668.69, 25776.44, 25686.69, 25196.73, 25067.27, 25132.94, 24647.61, 25019.37, 25346.18, 25461.7, 25587.83, 25656.15, 25644.39, 25525.56, 25462.56, 25249.85, 25206.17, 25401.32, 25639.71, 25653.9, 25507.1, 25766.26, 25787.66, 25741.95, 25465.94, 25547.07, 25529.26, 24987.57, 25326.58, 25518.35, 25605.47, 25713.21, 25939.74, 26022.79, 25884.3, 25552.39, 25738.61, 25338.62, 24891.24, 24548.69, 25075.77, 25268.14, 25127.64, 25201.26, 24687.61, 24732.73]}, "usd_krw": {"name": "USD/KRW", "current": 1440.9, "day_change": -0.23, "period_change": 4.51, "dates": ["2025-08-14", "2025-08-15", "2025-08-18", "2025-08-19", "2025-08-20", "2025-08-21", "2025-08-22", "2025-08-25", "2025-08-26", "2025-08-27", "2025-08-28", "2025-08-29", "2025-09-01", "2025-09-02", "2025-09-03", "2025-09-04", "2025-09-05", "2025-09-08", "2025-09-09", "2025-09-10", "2025-09-11", "2025-09-12", "2025-09-15", "2025-09-16", "2025-09-17", "2025-09-18", "2025-09-19", "2025-09-22", "2025-09-23", "2025-09-24", "2025-09-25", "2025-09-26", "2025-09-29", "2025-09-30", "2025-10-01", "2025-10-02", "2025-10-03", "2025-10-06", "2025-10-07", "2025-10-08", "2025-10-09", "2025-10-10", "2025-10-13", "2025-10-14", "2025-10-15", "2025-10-16", "2025-10-17", "2025-10-20", "2025-10-21", "2025-10-22", "2025-10-23", "2025-10-24", "2025-10-27", "2025-10-28", "2025-10-29", "2025-10-30", "2025-10-31", "2025-11-03", "2025-11-04", "2025-11-05", "2025-11-06", "2025-11-07", "2025-11-10", "2025-11-11", "2025-11-12", "2025-11-13", "2025-11-14", "2025-11-17", "2025-11-18", "2025-11-19", "2025-11-20", "2025-11-21", "2025-11-24", "2025-11-25", "2025-11-26", "2025-11-27", "2025-11-28", "2025-12-01", "2025-12-02", "2025-12-03", "2025-12-04", "2025-12-05", "2025-12-08", "2025-12-09", "2025-12-10", "2025-12-11", "2025-12-12", "2025-12-15", "2025-12-16", "2025-12-17", "2025-12-18", "2025-12-19", "2025-12-22", "2025-12-23", "2025-12-24", "2025-12-26", "2025-12-29", "2025-12-30", "2025-12-31", "2026-01-02", "2026-01-05", "2026-01-06", "2026-01-07", "2026-01-08", "2026-01-09", "2026-01-12", "2026-01-13", "2026-01-14", "2026-01-15", "2026-01-16", "2026-01-19", "2026-01-20", "2026-01-21", "2026-01-22", "2026-01-23", "2026-01-26", "2026-01-27", "2026-01-28", "2026-01-29", "2026-01-30", "2026-02-02", "2026-02-03", "2026-02-04", "2026-02-05", "2026-02-06", "2026-02-09", "2026-02-10", "2026-02-11", "2026-02-12", "2026-02-13"], "values": [1378.78, 1387.87, 1387.98, 1386.91, 1391.34, 1396.91, 1399.61, 1382.89, 1389.05, 1393.95, 1392.75, 1384.41, 1388.84, 1392.94, 1394.57, 1389.63, 1392.06, 1385.51, 1385.72, 1387.25, 1387.2, 1389.5, 1393.7, 1385.01, 1377.64, 1378.69, 1386.75, 1396.23, 1389.39, 1391.85, 1403.65, 1408.92, 1408.71, 1399.33, 1403.15, 1401.82, 1405.63, 1406.06, 1409.92, 1414.57, 1422.52, 1421.51, 1429.03, 1426.07, 1429.43, 1420.09, 1415.72, 1419.74, 1419.74, 1430.74, 1430.4, 1435.84, 1436.97, 1430.97, 1425.97, 1424.01, 1424.02, 1427.17, 1428.97, 1439.81, 1439.74, 1447.9, 1454.0, 1456.09, 1459.84, 1468.02, 1468.71, 1446.53, 1461.69, 1456.55, 1466.13, 1473.25, 1467.73, 1474.86, 1464.92, 1470.59, 1461.4, 1465.62, 1470.17, 1467.36, 1465.03, 1472.38, 1471.81, 1468.51, 1467.93, 1469.04, 1470.85, 1472.91, 1467.48, 1471.74, 1474.0, 1474.36, 1473.72, 1476.84, 1478.67, 1446.52, 1441.33, 1434.71, 1437.91, 1443.64, 1440.48, 1445.56, 1444.96, 1446.14, 1450.08, 1455.24, 1464.93, 1473.01, 1462.9, 1468.84, 1471.58, 1471.52, 1477.78, 1464.83, 1463.26, 1444.81, 1440.98, 1432.51, 1429.27, 1428.76, 1448.8, 1452.54, 1446.68, 1460.11, 1470.68, 1462.4, 1458.54, 1455.33, 1444.19, 1440.9]}, "gold": {"name": "Gold", "current": 5063.8, "day_change": 2.85, "period_change": 50.77, "dates": ["2025-08-13", "2025-08-14", "2025-08-15", "2025-08-18", "2025-08-19", "2025-08-20", "2025-08-21", "2025-08-22", "2025-08-25", "2025-08-26", "2025-08-27", "2025-08-28", "2025-08-29", "2025-09-02", "2025-09-03", "2025-09-04", "2025-09-05", "2025-09-08", "2025-09-09", "2025-09-10", "2025-09-11", "2025-09-12", "2025-09-15", "2025-09-16", "2025-09-17", "2025-09-18", "2025-09-19", "2025-09-22", "2025-09-23", "2025-09-24", "2025-09-25", "2025-09-26", "2025-09-29", "2025-09-30", "2025-10-01", "2025-10-02", "2025-10-03", "2025-10-06", "2025-10-07", "2025-10-08", "2025-10-09", "2025-10-10", "2025-10-13", "2025-10-14", "2025-10-15", "2025-10-16", "2025-10-17", "2025-10-20", "2025-10-21", "2025-10-22", "2025-10-23", "2025-10-24", "2025-10-27", "2025-10-28", "2025-10-29", "2025-10-30", "2025-10-31", "2025-11-03", "2025-11-04", "2025-11-05", "2025-11-06", "2025-11-07", "2025-11-10", "2025-11-11", "2025-11-12", "2025-11-13", "2025-11-14", "2025-11-17", "2025-11-18", "2025-11-19", "2025-11-20", "2025-11-21", "2025-11-24", "2025-11-25", "2025-11-26", "2025-11-28", "2025-12-01", "2025-12-02", "2025-12-03", "2025-12-04", "2025-12-05", "2025-12-08", "2025-12-09", "2025-12-10", "2025-12-11", "2025-12-12", "2025-12-15", "2025-12-16", "2025-12-17", "2025-12-18", "2025-12-19", "2025-12-22", "2025-12-23", "2025-12-24", "2025-12-26", "2025-12-29", "2025-12-30", "2025-12-31", "2026-01-02", "2026-01-05", "2026-01-06", "2026-01-07", "2026-01-08", "2026-01-09", "2026-01-12", "2026-01-13", "2026-01-14", "2026-01-15", "2026-01-16", "2026-01-20", "2026-01-21", "2026-01-22", "2026-01-23", "2026-01-26", "2026-01-27", "2026-01-28", "2026-01-29", "2026-01-30", "2026-02-02", "2026-02-03", "2026-02-04", "2026-02-05", "2026-02-06", "2026-02-09", "2026-02-10", "2026-02-11", "2026-02-12", "2026-02-13"], "values": [3358.7, 3335.2, 3336.0, 3331.7, 3313.4, 3343.4, 3336.9, 3374.4, 3373.8, 3388.6, 3404.6, 3431.8, 3473.7, 3549.4, 3593.2, 3565.8, 3613.2, 3638.1, 3643.3, 3643.6, 3636.9, 3649.4, 3682.2, 3688.9, 3681.8, 3643.7, 3671.5, 3740.7, 3780.6, 3732.1, 3736.9, 3775.3, 3820.9, 3840.8, 3867.5, 3839.7, 3880.8, 3948.5, 3976.6, 4043.3, 3946.3, 3975.9, 4108.6, 4138.7, 4176.9, 4280.2, 4189.9, 4336.4, 4087.7, 4044.4, 4125.5, 4118.4, 4001.9, 3966.2, 3983.7, 4001.3, 3982.2, 4000.3, 3947.7, 3980.3, 3979.9, 3999.4, 4111.8, 4106.8, 4204.4, 4186.9, 4087.6, 4068.3, 4061.3, 4077.7, 4056.5, 4076.7, 4091.9, 4139.2, 4165.2, 4218.3, 4239.3, 4186.6, 4199.3, 4211.8, 4212.9, 4187.2, 4206.7, 4196.4, 4285.5, 4300.1, 4306.7, 4304.5, 4347.5, 4339.5, 4361.4, 4444.6, 4482.8, 4480.6, 4529.1, 4325.1, 4370.1, 4325.6, 4314.4, 4436.9, 4482.2, 4449.3, 4449.7, 4490.3, 4604.3, 4589.2, 4626.3, 4616.3, 4588.4, 4759.6, 4831.8, 4908.8, 4976.2, 5079.7, 5079.9, 5301.6, 5318.4, 4713.9, 4622.5, 4903.7, 4920.4, 4861.4, 4951.2, 5050.9, 5003.8, 5071.6, 4923.7, 5063.8]}}, "strategy": {"current_params": {}, "current_regime": "unknown", "regime_confidence": 0, "last_tuned_at": ""}, "signal_weights": {}, "tuning_history": [], "backtest": {"summary": {}, "signal_performance": [], "monthly_returns": [], "score_buckets": []}};

// â”€â”€ ìœ í‹¸ â”€â”€
const fmt = (v, d=2) => v != null ? Number(v).toFixed(d) : 'â€”';
const pnlClass = v => v > 0 ? 'positive' : v < 0 ? 'negative' : 'neutral';
const pnlSign = v => v > 0 ? '+' + fmt(v) : fmt(v);
const regimeIcon = r => ({bullish:'ğŸ‚',bearish:'ğŸ»',sideways:'ğŸ“Š',conservative:'ğŸ›¡ï¸'})[r] || 'â“';
const regimeClass = r => 'regime-' + (r || 'unknown');

// â”€â”€ íƒ­ ì „í™˜ â”€â”€
function showTab(id) {
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.getElementById('tab-' + id).classList.add('active');
  event.target.classList.add('active');
}

// â”€â”€ ì´ˆê¸°í™” â”€â”€
function init() {
  // ìƒë‹¨ë°”
  const gen = D.generated_at ? new Date(D.generated_at) : new Date();
  document.getElementById('lastUpdate').textContent = 'ê°±ì‹ : ' + gen.toLocaleString('ko-KR');
  const regime = D.strategy?.current_regime || 'unknown';
  const conf = D.strategy?.regime_confidence || 0;
  const badge = document.getElementById('regimeBadge');
  badge.className = 'regime-badge ' + regimeClass(regime);
  badge.textContent = regimeIcon(regime) + ' ' + regime.toUpperCase() + ' (' + Math.round(conf * 100) + '%)';

  renderMarket();
  renderStatCards();
  renderOpenPositions();
  renderHistory();
  renderPerformance();
  renderBacktest();
  renderTuning();
}

// â•â•â•â• TAB 0: ì‹œì¥ í˜„í™© (ì‹¤ì‹œê°„ API) â•â•â•â•
const MARKET_CFG = {
  sp500:   { ticker: '%5EGSPC', name: 'S&P 500',    icon: 'ğŸ‡ºğŸ‡¸', unit: '',  color: '#38bdf8', bg: 'rgba(56,189,248,0.08)',  canvas: 'sp500Chart',  title: 'sp500Title' },
  nasdaq:  { ticker: '%5ENDX',  name: 'NASDAQ 100', icon: 'ğŸ’»', unit: '',  color: '#a78bfa', bg: 'rgba(167,139,250,0.08)', canvas: 'nasdaqChart', title: 'nasdaqTitle' },
  usd_krw: { ticker: 'KRW%3DX', name: 'USD/KRW',   icon: 'ğŸ’±', unit: 'â‚©', color: '#fbbf24', bg: 'rgba(251,191,36,0.08)',  canvas: 'usdkrwChart', title: 'usdkrwTitle' },
  gold:    { ticker: 'GC%3DF',  name: 'Gold',       icon: 'ğŸ¥‡', unit: '$', color: '#fb923c', bg: 'rgba(251,146,60,0.08)',  canvas: 'goldChart',   title: 'goldTitle' },
};
let marketCharts = {};
let currentPeriod = '6mo';
const periodLabels = { '1mo': '1ê°œì›”', '3mo': '3ê°œì›”', '6mo': '6ê°œì›”', '1y': '1ë…„' };

function switchPeriod(range) {
  currentPeriod = range;
  document.querySelectorAll('.period-btn').forEach(b => b.classList.toggle('active', b.dataset.range === range));
  fetchMarketData(range);
}

async function fetchYahoo(ticker, range) {
  const intervals = { '1mo': '1d', '3mo': '1d', '6mo': '1d', '1y': '1wk' };
  const interval = intervals[range] || '1d';
  const url = `https://query1.finance.yahoo.com/v8/finance/chart/${ticker}?range=${range}&interval=${interval}`;
  // ì§ì ‘ í˜¸ì¶œ ì‹œë„ â†’ CORS ì‹¤íŒ¨ì‹œ í”„ë¡ì‹œ í´ë°±
  try {
    const resp = await fetch(url);
    if (!resp.ok) throw new Error(resp.status);
    return await resp.json();
  } catch(e) {
    const proxy = `https://corsproxy.io/?${encodeURIComponent(url)}`;
    const resp2 = await fetch(proxy);
    if (!resp2.ok) throw new Error(`proxy ${resp2.status}`);
    return await resp2.json();
  }
}

function parseYahoo(json) {
  const r = json?.chart?.result?.[0];
  if (!r) return null;
  const ts = r.timestamp || [];
  const closes = r.indicators?.quote?.[0]?.close || [];
  const dates = [], values = [];
  for (let i = 0; i < ts.length; i++) {
    if (closes[i] == null) continue;
    const d = new Date(ts[i] * 1000);
    dates.push(`${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`);
    values.push(Math.round(closes[i] * 100) / 100);
  }
  if (!values.length) return null;
  const current = values[values.length - 1];
  const prev = values.length >= 2 ? values[values.length - 2] : current;
  const first = values[0];
  const dayChg = prev ? Math.round((current - prev) / prev * 10000) / 100 : 0;
  const perChg = first ? Math.round((current - first) / first * 10000) / 100 : 0;
  return { current, dayChg, perChg, dates, values };
}

async function fetchMarketData(range) {
  const statusEl = document.getElementById('marketStatus');
  statusEl.textContent = 'â³ ë°ì´í„° ê°€ì ¸ì˜¤ëŠ” ì¤‘...';

  const results = {};
  const promises = Object.entries(MARKET_CFG).map(async ([key, cfg]) => {
    try {
      const json = await fetchYahoo(cfg.ticker, range);
      const parsed = parseYahoo(json);
      if (parsed) results[key] = parsed;
    } catch(e) {
      console.warn(`${cfg.name} ë¡œë“œ ì‹¤íŒ¨:`, e);
    }
  });
  await Promise.all(promises);

  const now = new Date();
  statusEl.textContent = `âœ… ${now.toLocaleTimeString('ko-KR')} ê¸°ì¤€ Â· ${Object.keys(results).length}/4 ì§€í‘œ`;

  // ì¹´ë“œ ë Œë”ë§
  const fmtPrice = (k, v) => k === 'usd_krw' ? v.toLocaleString('ko-KR', {maximumFractionDigits:2}) : v.toLocaleString('en-US', {maximumFractionDigits:2});

  if (!Object.keys(results).length) {
    document.getElementById('marketCards').innerHTML = '<div class="empty-state" style="grid-column:1/-1"><div class="icon">ğŸŒ</div>ì‹œì¥ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤<br><small style="color:var(--text2)">ë„¤íŠ¸ì›Œí¬ í™•ì¸ í›„ ìƒˆë¡œê³ ì¹¨í•´ ì£¼ì„¸ìš”</small></div>';
    return;
  }

  let cards = '';
  for (const [key, cfg] of Object.entries(MARKET_CFG)) {
    const d = results[key];
    if (!d) continue;
    const dc = d.dayChg, pc = d.perChg;
    cards += `<div class="card">
      <div class="card-header">${cfg.icon} ${cfg.name}</div>
      <div class="card-value" style="font-size:22px;">${cfg.unit}${fmtPrice(key, d.current)}</div>
      <div class="card-sub">
        <span class="${pnlClass(dc)}">ì¼ê°„ ${dc > 0 ? '+' : ''}${dc.toFixed(2)}%</span>
        &nbsp;Â·&nbsp;
        <span class="${pnlClass(pc)}"> ${periodLabels[range]} ${pc > 0 ? '+' : ''}${pc.toFixed(2)}%</span>
      </div>
    </div>`;
  }
  document.getElementById('marketCards').innerHTML = cards;

  // ì°¨íŠ¸ ë Œë”ë§
  for (const [key, cfg] of Object.entries(MARKET_CFG)) {
    const d = results[key];
    const el = document.getElementById(cfg.canvas);
    const titleEl = document.getElementById(cfg.title);
    if (!el) continue;

    const titleIcons = { sp500: 'ğŸ“ˆ', nasdaq: 'ğŸ“ˆ', usd_krw: 'ğŸ’±', gold: 'ğŸ¥‡' };
    if (titleEl) titleEl.textContent = `${titleIcons[key] || 'ğŸ“ˆ'} ${cfg.name} (${periodLabels[range]})`;

    // ê¸°ì¡´ ì°¨íŠ¸ íŒŒê´´
    if (marketCharts[key]) { marketCharts[key].destroy(); marketCharts[key] = null; }

    if (!d || !d.dates.length) continue;

    marketCharts[key] = new Chart(el, {
      type: 'line',
      data: {
        labels: d.dates,
        datasets: [{
          label: cfg.name,
          data: d.values,
          borderColor: cfg.color,
          backgroundColor: cfg.bg,
          fill: true,
          tension: 0.3,
          pointRadius: 0,
          pointHitRadius: 8,
          borderWidth: 2,
        }]
      },
      options: {
        ...chartOpts(''),
        plugins: {
          legend: { display: false },
          tooltip: {
            mode: 'index', intersect: false,
            callbacks: {
              label: (ctx) => `${cfg.name}: ${cfg.unit || '$'}${ctx.parsed.y.toLocaleString()}`
            }
          },
        },
        interaction: { mode: 'nearest', axis: 'x', intersect: false },
      },
    });
  }
}

function renderMarket() {
  fetchMarketData(currentPeriod);
}

// â•â•â•â• TAB 1: í¬ì§€ì…˜ â•â•â•â•
function renderStatCards() {
  const s = D.stats || {};
  const openCount = (D.positions || []).filter(p => p.status === 'open').length;
  const html = [
    statCard('ì˜¤í”ˆ í¬ì§€ì…˜', openCount, '', 'accent'),
    statCard('ì´ ê±°ë˜', s.total_trades || 0, `ìŠ¹ ${s.wins||0} / íŒ¨ ${s.losses||0}`, ''),
    statCard('ìŠ¹ë¥ ', fmt(s.win_rate||0,1)+'%', `ë§Œë£Œ ${s.expired||0}ê±´`, pnlClass(s.win_rate-50)),
    statCard('ëˆ„ì  ìˆ˜ìµ', pnlSign(s.total_pnl_pct||0)+'%', `í‰ê·  ${pnlSign(s.avg_pnl_pct||0)}%`, pnlClass(s.total_pnl_pct)),
  ].join('');
  document.getElementById('statCards').innerHTML = html;
}

function statCard(title, value, sub, cls) {
  return `<div class="card"><div class="card-header">${title}</div><div class="card-value ${cls}">${value}</div><div class="card-sub">${sub}</div></div>`;
}

function renderOpenPositions() {
  const open = (D.positions || []).filter(p => p.status === 'open');
  if (!open.length) {
    document.getElementById('openPositionsTable').innerHTML = '<div class="empty-state"><div class="icon">ğŸ“­</div>ì˜¤í”ˆ í¬ì§€ì…˜ì´ ì—†ìŠµë‹ˆë‹¤</div>';
    return;
  }
  let html = '<table><thead><tr><th>ì¢…ëª©</th><th>ì§„ì…ê°€</th><th>í˜„ì¬ê°€</th><th>P&L</th><th>ì†ì ˆ</th><th>ìµì ˆ</th><th>ì ìˆ˜</th><th>ì§„ì…ì¼</th></tr></thead><tbody>';
  for (const p of open) {
    const last = p.price_history?.length ? p.price_history[p.price_history.length-1].close : p.entry_price;
    const pnl = ((last - p.entry_price) / p.entry_price * 100);
    html += `<tr>
      <td><strong>${p.ticker}</strong></td>
      <td>${fmt(p.entry_price)}</td>
      <td>${fmt(last)}</td>
      <td class="${pnlClass(pnl)}"><strong>${pnlSign(pnl)}%</strong></td>
      <td class="negative">${fmt(p.stop_loss)}</td>
      <td class="positive">${fmt(p.take_profit)}</td>
      <td>${fmt(p.tech_score,1)}</td>
      <td>${p.entry_date}</td>
    </tr>`;
  }
  html += '</tbody></table>';
  document.getElementById('openPositionsTable').innerHTML = html;
}

function renderHistory() {
  const hist = (D.history || []).slice().reverse().slice(0, 30);
  if (!hist.length) {
    document.getElementById('historyTable').innerHTML = '<div class="empty-state"><div class="icon">ğŸ“œ</div>ì²­ì‚° ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤</div>';
    return;
  }
  let html = '<table><thead><tr><th>ì¢…ëª©</th><th>ì§„ì…</th><th>ì²­ì‚°</th><th>P&L</th><th>ìœ í˜•</th><th>ë³´ìœ ì¼</th><th>ì§„ì…ì¼</th></tr></thead><tbody>';
  for (const h of hist) {
    const reason = h.close_reason || '';
    html += `<tr>
      <td><strong>${h.ticker}</strong></td>
      <td>${fmt(h.entry_price)}</td>
      <td>${fmt(h.exit_price)}</td>
      <td class="${pnlClass(h.pnl_pct)}"><strong>${pnlSign(h.pnl_pct)}%</strong></td>
      <td class="status-${reason}">${{take_profit:'âœ… ìµì ˆ',stop_loss:'ğŸ›‘ ì†ì ˆ',expired:'â° ë§Œë£Œ'}[reason]||reason}</td>
      <td>${h.hold_days||'â€”'}</td>
      <td>${h.entry_date}</td>
    </tr>`;
  }
  html += '</tbody></table>';
  document.getElementById('historyTable').innerHTML = html;
}

// â•â•â•â• TAB 2: ì„±ê³¼ â•â•â•â•
function renderPerformance() {
  // ëˆ„ì  ìˆ˜ìµ ì°¨íŠ¸
  const cumData = D.daily_cumulative_pnl || {};
  const dates = Object.keys(cumData).sort();
  if (dates.length > 0) {
    new Chart(document.getElementById('cumulativeChart'), {
      type: 'line',
      data: {
        labels: dates,
        datasets: [{
          label: 'ëˆ„ì  ìˆ˜ìµë¥  (%)',
          data: dates.map(d => cumData[d]),
          borderColor: '#38bdf8',
          backgroundColor: 'rgba(56,189,248,0.1)',
          fill: true,
          tension: 0.3,
          pointRadius: dates.length > 30 ? 0 : 3,
        }]
      },
      options: chartOpts(''),
    });
  }

  // ì›”ë³„ ì„±ê³¼ ì°¨íŠ¸
  const mp = D.monthly_performance || {};
  const months = Object.keys(mp).sort();
  if (months.length > 0) {
    new Chart(document.getElementById('monthlyChart'), {
      type: 'bar',
      data: {
        labels: months,
        datasets: [{
          label: 'ì›” ìˆ˜ìµë¥  (%)',
          data: months.map(m => mp[m].total_pnl),
          backgroundColor: months.map(m => mp[m].total_pnl >= 0 ? 'rgba(52,211,153,0.7)' : 'rgba(248,113,113,0.7)'),
          borderRadius: 4,
        }]
      },
      options: chartOpts(''),
    });

    // ì›”ë³„ ìƒì„¸ í…Œì´ë¸”
    let mhtml = '<table><thead><tr><th>ì›”</th><th>ê±°ë˜</th><th>ìŠ¹ë¥ </th><th>ìˆ˜ìµ</th></tr></thead><tbody>';
    for (const m of months) {
      const d = mp[m];
      mhtml += `<tr><td>${m}</td><td>${d.trades}</td><td>${d.win_rate}%</td><td class="${pnlClass(d.total_pnl)}">${pnlSign(d.total_pnl)}%</td></tr>`;
    }
    mhtml += '</tbody></table>';
    document.getElementById('monthlyDetailTable').innerHTML = mhtml;
  }

  // ì²­ì‚° ìœ í˜• ë„ë„›
  const et = D.exit_types || {};
  const total = (et.take_profit||0) + (et.stop_loss||0) + (et.expired||0);
  if (total > 0) {
    new Chart(document.getElementById('exitTypeChart'), {
      type: 'doughnut',
      data: {
        labels: ['ìµì ˆ', 'ì†ì ˆ', 'ë§Œë£Œ'],
        datasets: [{
          data: [et.take_profit||0, et.stop_loss||0, et.expired||0],
          backgroundColor: ['#34d399', '#f87171', '#fbbf24'],
          borderWidth: 0,
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'bottom', labels: { color: '#94a3b8', font: { family: "'JetBrains Mono'" } } },
        },
      },
    });
  }
}

// â•â•â•â• TAB 3: ë°±í…ŒìŠ¤íŠ¸ â•â•â•â•
function renderBacktest() {
  const bt = D.backtest?.summary || {};
  if (!bt.total_trades) {
    document.getElementById('btStatCards').innerHTML = '<div class="empty-state" style="grid-column:1/-1"><div class="icon">ğŸ”¬</div>ë°±í…ŒìŠ¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
    return;
  }

  document.getElementById('btStatCards').innerHTML = [
    statCard('ì´ ê±°ë˜', bt.total_trades, `ìŠ¹ë¥  ${fmt(bt.win_rate,1)}%`, ''),
    statCard('Profit Factor', fmt(bt.profit_factor), `ê¸°ëŒ€ê°’ ${pnlSign(bt.expected_value_pct)}%`, pnlClass(bt.profit_factor-1)),
    statCard('ìƒ¤í”„ ë¹„ìœ¨', fmt(bt.sharpe_ratio), `MDD ${fmt(bt.portfolio_max_drawdown_pct,1)}%`, pnlClass(bt.sharpe_ratio)),
    statCard('ëˆ„ì  ìˆ˜ìµ', pnlSign(bt.total_pnl_pct)+'%', `í‰ê·  ${pnlSign(bt.avg_pnl_pct)}%`, pnlClass(bt.total_pnl_pct)),
  ].join('');

  // ì‹ í˜¸ë³„ ì„±ê³¼
  const sp = D.backtest?.signal_performance || [];
  if (sp.length) {
    const sorted = sp.slice().sort((a,b) => (b.avg_pnl||0) - (a.avg_pnl||0));
    new Chart(document.getElementById('signalChart'), {
      type: 'bar',
      data: {
        labels: sorted.map(s => s.signal),
        datasets: [
          {
            label: 'í‰ê·  ìˆ˜ìµ (%)',
            data: sorted.map(s => s.avg_pnl),
            backgroundColor: sorted.map(s => s.avg_pnl >= 0 ? 'rgba(52,211,153,0.7)' : 'rgba(248,113,113,0.7)'),
            borderRadius: 4,
          },
        ]
      },
      options: { ...chartOpts(''), indexAxis: 'y' },
    });
  }

  // ì ìˆ˜ êµ¬ê°„ë³„
  const sb = D.backtest?.score_buckets || [];
  if (sb.length) {
    new Chart(document.getElementById('scoreBucketChart'), {
      type: 'bar',
      data: {
        labels: sb.map(s => s.range),
        datasets: [
          { label: 'ìŠ¹ë¥  (%)', data: sb.map(s => s.win_rate), backgroundColor: 'rgba(56,189,248,0.6)', borderRadius: 4 },
          { label: 'í‰ê· ìˆ˜ìµ (%)', data: sb.map(s => s.avg_pnl), backgroundColor: 'rgba(167,139,250,0.6)', borderRadius: 4 },
        ]
      },
      options: chartOpts(''),
    });
  }

  // ë°±í…ŒìŠ¤íŠ¸ ì›”ë³„
  const bm = D.backtest?.monthly_returns || [];
  if (bm.length) {
    new Chart(document.getElementById('btMonthlyChart'), {
      type: 'bar',
      data: {
        labels: bm.map(m => m.month),
        datasets: [{
          label: 'ì›” ìˆ˜ìµ (%)',
          data: bm.map(m => m.total_pnl_pct),
          backgroundColor: bm.map(m => m.total_pnl_pct >= 0 ? 'rgba(52,211,153,0.7)' : 'rgba(248,113,113,0.7)'),
          borderRadius: 4,
        }]
      },
      options: chartOpts(''),
    });
  }
}

// â•â•â•â• TAB 4: ìê¸°í•™ìŠµ â•â•â•â•
function renderTuning() {
  const params = D.strategy?.current_params || {};
  const paramLabels = {
    top_n: 'ì¼ë³„ ì„ íƒ ì¢…ëª©',
    min_tech_score: 'ìµœì†Œ ê¸°ìˆ  ì ìˆ˜',
    atr_stop_mult: 'ì†ì ˆ ATR ë°°ìˆ˜',
    atr_tp_mult: 'ìµì ˆ ATR ë°°ìˆ˜',
    max_hold_days: 'ìµœëŒ€ ë³´ìœ ì¼',
  };
  let phtml = '';
  for (const [k, v] of Object.entries(params)) {
    phtml += `<div class="param-item"><div class="label">${paramLabels[k]||k}</div><div class="value">${v}</div></div>`;
  }
  document.getElementById('paramGrid').innerHTML = phtml || '<div class="empty-state">íŒŒë¼ë¯¸í„° ì—†ìŒ</div>';

  // ì‹ í˜¸ ê°€ì¤‘ì¹˜ ë°”
  const w = D.signal_weights || {};
  const wKeys = Object.keys(w).sort((a,b) => w[b] - w[a]);
  let whtml = '';
  for (const k of wKeys) {
    const v = w[k];
    const pct = Math.min(100, (v / 2.5) * 100);
    const color = v > 1.2 ? 'var(--green)' : v < 0.8 ? 'var(--red)' : 'var(--accent)';
    whtml += `<div class="weight-bar">
      <span class="label">${k}</span>
      <div class="bar"><div class="fill" style="width:${pct}%;background:${color}"></div></div>
      <span class="val" style="color:${color}">${v.toFixed(2)}</span>
    </div>`;
  }
  document.getElementById('weightBars').innerHTML = whtml || '<div class="empty-state">ê°€ì¤‘ì¹˜ ë°ì´í„° ì—†ìŒ</div>';

  // íŠœë‹ ì´ë ¥ í…Œì´ë¸”
  const th = (D.tuning_history || []).slice().reverse();
  if (th.length) {
    let thtml = '<table><thead><tr><th>ë‚ ì§œ</th><th>ë ˆì§</th><th>ê±°ë˜</th><th>ìŠ¹ë¥ </th><th>PF</th><th>ë³€ê²½</th></tr></thead><tbody>';
    for (const t of th) {
      const s = t.summary || {};
      const pc = Object.keys(t.param_changes||{}).length;
      const wc = Object.keys(t.weight_changes||{}).length;
      thtml += `<tr>
        <td>${(t.timestamp||'').slice(0,10)}</td>
        <td><span class="regime-badge ${regimeClass(t.regime)}" style="font-size:11px;padding:2px 8px;">${regimeIcon(t.regime)} ${t.regime}</span></td>
        <td>${s.total_trades||'â€”'}</td>
        <td>${fmt(s.win_rate,1)}%</td>
        <td>${fmt(s.profit_factor)}</td>
        <td>íŒŒë¼ë¯¸í„° ${pc}ê±´, ê°€ì¤‘ì¹˜ ${wc}ê±´</td>
      </tr>`;
    }
    thtml += '</tbody></table>';
    document.getElementById('tuningHistoryTable').innerHTML = thtml;
  } else {
    document.getElementById('tuningHistoryTable').innerHTML = '<div class="empty-state"><div class="icon">ğŸ§ </div>íŠœë‹ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤</div>';
  }
}

// â”€â”€ Chart.js ê³µí†µ ì˜µì…˜ â”€â”€
function chartOpts(yLabel) {
  return {
    responsive: true,
    maintainAspectRatio: true,
    scales: {
      x: { ticks: { color: '#64748b', font: { family: "'JetBrains Mono'", size: 10 } }, grid: { color: 'rgba(42,52,72,0.5)' } },
      y: { ticks: { color: '#64748b', font: { family: "'JetBrains Mono'", size: 10 } }, grid: { color: 'rgba(42,52,72,0.5)' },
           title: yLabel ? { display:true, text:yLabel, color:'#94a3b8' } : {} },
    },
    plugins: {
      legend: { labels: { color: '#94a3b8', font: { family: "'JetBrains Mono'" } } },
    },
  };
}

init();
</script>
</body>
</html>